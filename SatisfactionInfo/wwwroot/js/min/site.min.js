let toDelete=-1;function clearFilter(){location.href="/UserQuestionnaries"}function showUpdateFilter(){let e=$("#filterName").val(),n=$("#filterCode").val(),t=$("#filterDate").val(),d=$("#filterDescription").val();(e.length>0||n.length>0||t.length>0||d.length>0)&&show("#buttonUpdateFilter")}function togglechecked(e){$(e).is(":checked")?$(e).prop("checked",!1):$(e).prop("checked",!0)}function loader(){$(".loader").toggleClass("hidden")}function log(e){console.log(e)}function hide(e){let n=$(e);n.hasClass("hidden")||n.addClass("hidden")}function show(e){let n=$(e);n.hasClass("hidden")&&n.removeClass("hidden")}function change(e,n){hide(e),show(n)}function showPopup(e,n){toDelete=e,show(n)}function hidePopup(){$(".confirmation").each(function(){$(this).hasClass("hidden")||$(this).addClass("hidden")}),toDelete=-1}function toggleRow(e,n){let t=$(e),d=$(n);d.hasClass("fa-angle-down")?(d.removeClass("fa-angle-down"),d.addClass("fa-angle-up"),t.removeClass("hidden")):(d.removeClass("fa-angle-up"),d.addClass("fa-angle-down"),t.addClass("hidden"))}$(document).ready(function(){let e=parseInt($("#questionCount").val());if(!isNaN(e)){$("#questionnarieCode").val();let e=$("#questions").val().split(";").filter(Boolean);for(var n=1;n<=e[e.length-1];n++){let e=n,t=$("#questionnarieCode").val(),d=$("#addWhyBody_"+String(e)).val();void 0===d&&(d=null);let a={Code:t,QuestionNumber:e,Answered:"",AddWhyBody:""};model[e-1]=a}}});let model=[];function updateAddWhyBody(e){model[e-1].AddWhyBody=$("#addWhyBody_"+String(e)).val()}function updateSimlpeAnswer(e,n){model[e-1].Answered=$(n).val(),model[e-1].Answered.length>0&&removeRequired(e)}function updateTempAnswer(e,n,t,d){model[e-1].Answered=calculateAnswered(model[e-1].Answered,t,n,d),model[e-1].Answered.length>0&&removeRequired(e)}function calculateAnswered(e,n,t,d){return"jednokrotny"===t.toLowerCase()||"numeryczny"===t.toLowerCase()?e=n:"wielokrotny"===t.toLowerCase()&&(null!=d&&d.checked?e+=n+";":e=String(e).replace(n+";","")),e}function validInput(){let e="Brak odpowiedzi w pytaniach: ",n=$("#questions").val().split(";").filter(Boolean).sort();for(var t=0;t<model.length;t++)!n.includes(String(model[t].QuestionNumber))||null!=model[t].Answered&&""!=model[t].Answered?removeRequired(String(model[t].QuestionNumber)):(e+=model[t].QuestionNumber+"; ",addRequired(String(model[t].QuestionNumber)));return"Brak odpowiedzi w pytaniach: "==e||e}function addRequired(e){$("#required_"+e).addClass("required")}function removeRequired(e){$("#required_"+e).removeClass("required")}function sendQuestionnarie(){if(!0!==validInput())return addInfo(3,validInput()),void window.scrollTo(0,0);toggleInfo(),$("#sendBtn").attr("disabled","disabled"),$("#questionnarieContent").toggleClass("hidden"),loader(),$.ajax({type:"POST",url:"/Home/AddUserQuestionnarie",data:{item:$.extend({},model)},success:function(e){location.href="/Home/?Type="+e.info.type+"&Message="+e.info.message,$("#sendBtn").removeAttr("disabled")},error:function(e){addInfo(3,"Nie udało się zapisać ankiety. Przepraszamy."),$("#sendBtn").removeAttr("disabled"),loader(),$("#questionnarieContent").toggleClass("hidden")}})}function addQuestion(){$("#addBtn").attr("disabled","disabled");let e={Question:$("#newQuestionQuestion").val(),AddWhyName:$("#newQuestionAddWhyName").val(),AddWhy:$("#newQuestionAddWhy").is(":checked"),AnswerType:$("#newQuestionAnswerType").val()};loader(),$.ajax({type:"POST",url:"/Questions/AddOrUpdate",data:{item:e},success:function(e){$("#questionsTable").html(e),loader(),addInfo(2,"Dodano."),$("#addBtn").removeAttr("disabled")},error:function(e){addInfo(3,"Nie udało się zapisać."),$("#addBtn").removeAttr("disabled"),loader(),$("#addNewQuestion").toggleClass("hidden")}})}function updateQuestion(e){$("#editBtn").attr("disabled","disabled");let n={ID:e,Question:$("#editQuestionQuestion_"+String(e)).val(),AddWhyName:$("#editQuestionAddWhyName_"+String(e)).val(),AddWhy:$("#editQuestionAddWhy_"+String(e)).is(":checked"),AnswerType:$("#editQuestionAnswerType_"+String(e)).val()};loader(),$.ajax({type:"POST",url:"/Questions/AddOrUpdate",data:{item:n},success:function(e){$("#questionsTable").html(e),loader(),addInfo(2,"Zaktualizowano."),$("#editBtn").removeAttr("disabled")},error:function(e){addInfo(3,"Nie udało się zapisać."),$("#editBtn").removeAttr("disabled"),loader(),$("#addNewQuestion").toggleClass("hidden")}})}function deleteQuestion(){loader(),$.ajax({type:"Delete",url:"/Questions/Delete",data:{id:toDelete},success:function(e){"success"==e?($("#row_"+String(toDelete)).remove(),hidePopup(),loader(),addInfo(2,"Usunięto.")):(hidePopup(),loader(),addInfo(3,e))},error:function(e){addInfo(3,"Nie udało się usunąć."),loader(),hidePopup()}})}function addAnswer(){$("#addBtn").attr("disabled","disabled");let e={Answer:$("#newAnswerAnswer").val()};loader(),$.ajax({type:"POST",url:"/Answers/AddOrUpdate",data:{item:e},success:function(e){$("#answersTable").html(e),loader(),addInfo(2,"Dodano."),$("#addBtn").removeAttr("disabled")},error:function(e){addInfo(3,"Nie udało się zapisać."),$("#addBtn").removeAttr("disabled"),loader(),$("#addNewAnswer").toggleClass("hidden")}})}function updateAnswer(e){$("#editBtn").attr("disabled","disabled");let n={ID:e,Answer:$("#editAnswerAnswer_"+String(e)).val()};loader(),$.ajax({type:"POST",url:"/Answers/AddOrUpdate",data:{item:n},success:function(e){$("#answersTable").html(e),loader(),addInfo(2,"Zaktualizowano."),$("#editBtn").removeAttr("disabled")},error:function(e){addInfo(3,"Nie udało się zapisać."),$("#editBtn").removeAttr("disabled"),loader(),$("#addNewAnswer").toggleClass("hidden")}})}function deleteAnswer(){loader(),$.ajax({type:"Delete",url:"/Answers/Delete",data:{id:toDelete},success:function(e){"success"==e?($("#row_"+String(toDelete)).remove(),hidePopup(),loader(),addInfo(2,"Usunięto.")):(hidePopup(),loader(),addInfo(3,"Nie uało sie usunąć."))},error:function(e){addInfo(3,"Nie udało się usunąć."),loader(),hidePopup()}})}function addQuestionAnswer(e){$("#addQABtn_"+String(e)).attr("disabled","disabled");let n={questionId:e,answerId:$("#questionAnswer_"+String(e)).val()};loader(),$.ajax({type:"POST",url:"/Questions/AddQuestionAnswer",data:{item:n},success:function(n){"exists"==n?addInfo(1,"Taka odpowiedź już istnieje w pytaniu."):($("#qaTable_"+String(e)).html(n),addInfo(2,"Dodano.")),loader(),$("#addQABtn_"+String(e)).removeAttr("disabled")},error:function(n){addInfo(3,"Nie udało się zapisać."),$("#addQABtn_"+String(e)).removeAttr("disabled"),loader(),$("#addNewQuestionAnswer_"+String(e)).toggleClass("hidden")}})}function deleteQuestionAnswer(){loader();let e=$("#rowDetail_"+String(toDelete[0])+"_"+String(toDelete[1]));$.ajax({type:"Delete",url:"/Questions/DeleteQuestionAnswer",data:{QuestionId:toDelete[0],AnswerId:toDelete[1]},success:function(n){"success"==n?(e.remove(),hidePopup(),loader(),addInfo(2,"Usunięto.")):(loader(),addInfo(3,"Nie uało sie usunąć."))},error:function(e){addInfo(3,"Nie udało się usunąć."),loader(),hidePopup()}})}function addQuestionnarie(){$("#addBtn").attr("disabled","disabled");let e={Name:$("#newQuestionnarieName").val(),MaxAnswers:$("#newQuestionnarieMaxAnswers").val(),Description:$("#newQuestionnarieDescription").val()};loader(),$.ajax({type:"POST",url:"/Questionnaries/AddOrUpdate",data:{item:e},success:function(e){"Wypełnij wszystkie wymagane pola"!=e?($("#questionnariesTable").html(e),addInfo(2,"Dodano.")):addInfo(3,e),loader(),$("#addBtn").removeAttr("disabled")},error:function(e){addInfo(3,"Nie udało się zapisać."),$("#addBtn").removeAttr("disabled"),loader(),$("#addNewQuestionnarie").toggleClass("hidden")}})}function cloneQuestionnarie(e){loader(),$.ajax({type:"POST",url:"/Questionnaries/Clone",data:{id:e},success:function(e){"Wypełnij wszystkie wymagane pola"!=e?($("#questionnariesTable").html(e),addInfo(2,"Kopia wykonana.")):addInfo(3,e),loader()},error:function(e){addInfo(3,"Nie udało się zapisać."),loader()}})}function updateQuestionnarie(e){$("#editBtn").attr("disabled","disabled");let n={ID:e,Name:$("#editQuestionnarieName_"+String(e)).val(),Code:$("#editQuestionnarieCode_"+String(e)).val(),Active:$("#editQuestionnarieActive_"+String(e)).is(":checked"),MaxAnswers:$("#editQuestionnarieMaxAnswers_"+String(e)).val(),Description:$("#editQuestionnarieDescription_"+String(e)).val()};loader(),$.ajax({type:"POST",url:"/Questionnaries/AddOrUpdate",data:{item:n},success:function(e){"Wypełnij wszystkie wymagane pola"!=e?($("#questionnariesTable").html(e),addInfo(2,"Zaktualizowano."),$("#editBtn").removeAttr("disabled")):addInfo(3,e),loader()},error:function(e){addInfo(3,"Nie udało się zapisać."),$("#editBtn").removeAttr("disabled"),loader()}})}function deleteQuestionnarie(){loader(),$.ajax({type:"Delete",url:"/Questionnaries/Delete",data:{id:toDelete},success:function(e){"success"==e?($("#row_"+String(toDelete)).remove(),$("#row_questions_"+String(toDelete)).remove(),hidePopup(),loader(),addInfo(2,"Usunięto.")):(hidePopup(),loader(),addInfo(3,e))},error:function(e){addInfo(3,"Nie udało się usunąć."),loader(),hidePopup()}})}function addQuestionnarieQuestion(e){$("#addQQBtn"+String(e)).attr("disabled","disabled");let n={questionnarieId:e,questionId:$("#questionnarieQuestionQuestionId_"+String(e)).val(),questionNumber:$("#questionnarieQuestionQuestionNumber_"+String(e)).val()};loader(),$.ajax({type:"POST",url:"/Questionnaries/AddOrUpdateQuestionnarieQuestion",data:{item:n},success:function(n){"Wypełnij wszystkie wymagane pola"!=n&&"Pytanie istnieje w ankiecie"!=n?($("#qqTable_"+String(e)).html(n),addInfo(2,"Dodano."),$("#addQQBtn"+String(e)).removeAttr("disabled")):addInfo(3,n),loader()},error:function(n){addInfo(3,"Nie udało się zapisać."),$("#addQQBtn"+String(e)).removeAttr("disabled"),loader(),$("#addNewQuestion_"+String(e)).toggleClass("hidden")}})}function updateQuestionnarieQuestion(e,n){$("#editBtn"+String(e)).attr("disabled","disabled");let t={questionnarieId:e,questionId:$("#editQuestionQuestionId_"+String(e)+"_"+String(n)).val(),questionNumber:$("#editQuestionQuestionNumber_"+String(e)+"_"+String(n)).val()};loader(),$.ajax({type:"POST",url:"/Questionnaries/AddOrUpdateQuestionnarieQuestion",data:{item:t},success:function(n){"Wypełnij wszystkie wymagane pola"!=n?($("#qqTable_"+String(e)).html(n),addInfo(2,"Dodano."),$("#editBtn"+String(e)).removeAttr("disabled")):addInfo(3,n),loader()},error:function(n){addInfo(3,"Nie udało się zapisać."),$("#editBtn"+String(e)).removeAttr("disabled"),loader(),$("#addNewQuestion_"+String(e)).toggleClass("hidden")}})}function deleteQuestionnarieQuestion(){loader();let e=$("#rowDetail_"+String(toDelete[0])+"_"+String(toDelete[1]));$.ajax({type:"Delete",url:"/Questionnaries/DeleteQuestionnarieQuestion",data:{questionnarieId:toDelete[0],questionId:toDelete[1]},success:function(n){"success"==n?(e.remove(),hidePopup(),loader(),addInfo(2,"Usunięto.")):(loader(),addInfo(3,"Nie uało sie usunąć."))},error:function(e){addInfo(3,"Nie udało się usunąć."),loader(),hidePopup()}})}function updateFilter(){let e=$("#filterName").val(),n=$("#filterCode").val(),t=$("#filterDate").val(),d=$("#filterDescription").val();""!=e||""!=n||""!=t||""!=d?(loader(),$.ajax({type:"GET",url:"/UserQuestionnaries/GetFiltered",data:{page:1,name:e,code:n,date:t,description:d},success:function(e){"Problem z pobraniem danych"!=e?$("#questionnaries").html(e):addInfo(3,e),loader()},error:function(e){addInfo(3,"Nie udało się pobrać danych."),loader()}})):location.href="/UserQuestionnaries"}function toggleInfo(){$(".info").toggleClass("notVisible")}function addInfo(e,n){let t="";switch(e){case 1:t="info_msg";break;case 2:t="success_msg";break;case 3:t="danger_msg"}$(".info").html(""),$(".info").html('<div class="msg '+t+'"><div id="closeMsgJs" class="right fa fa-times-circle"></div>'+n+"</div>"),$(".info").removeClass("notVisible"),$("#closeMsgJs").on("click",toggleInfo)}$("document").ready(()=>{$("#closeMsg").on("click",toggleInfo)});